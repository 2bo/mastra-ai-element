# ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ä»•æ§˜æ›¸

æœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€å¤©æ°—ãƒãƒ£ãƒƒãƒˆã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé–“ã®é€£æºã«ã¤ã„ã¦è©³ç´°ã«è§£èª¬ã—ã¾ã™ã€‚

## ç›®æ¬¡

1. [ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦](#ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦)
2. [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³](#ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³)
3. [ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè©³ç´°](#ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè©³ç´°)
4. [ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼](#ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼)
5. [æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯](#æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯)

---

## ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦

ã“ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€Next.jsã€Vercel AI SDKã€Mastra.aiã€AI-ELEMENT ã‚’çµ±åˆã—ãŸ AI ãƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è‡ªç„¶è¨€èªã§å¤©æ°—ã«ã¤ã„ã¦è³ªå•ã§ãã€AI ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒé©åˆ‡ãªãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦å›ç­”ã‚’è¿”ã—ã¾ã™ã€‚

### ä¸»è¦ãªç‰¹å¾´

- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ¬ã‚¹ãƒãƒ³ã‚¹
- ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—æ©Ÿèƒ½ï¼ˆå¤©æ°—æƒ…å ±å–å¾—ï¼‰
- ãƒ¡ãƒ¢ãƒªæ©Ÿèƒ½ã«ã‚ˆã‚‹ä¼šè©±å±¥æ­´ã®ä¿æŒ
- AI ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ã«ã‚ˆã‚‹å“è³ªè©•ä¾¡
- è¦³æ¸¬å¯èƒ½æ€§ï¼ˆObservabilityï¼‰æ©Ÿèƒ½

---

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Frontend                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  app/page.tsx (ChatPage Component)                    â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  useChat Hook (@ai-sdk/react)                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - messages: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é…åˆ—                        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - sendMessage: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡é–¢æ•°                 â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - status: 'idle' | 'submitted' | 'streaming'   â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚
â”‚  â”‚  â”‚  ChatContainer (å…¨ä½“ã‚’å›²ã‚€ã‚³ãƒ³ãƒ†ãƒŠ)              â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  ChatHeader                              â”‚  â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  - title: "Weather Chat Assistant"     â”‚  â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  - description                          â”‚  â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  ChatConversation                        â”‚  â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”‚ AI-ELEMENT: Conversation           â”‚  â”‚  â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  â”‚ ChatMessageItem (å„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸) â”‚  â”‚  â”‚  â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  - Message                  â”‚  â”‚  â”‚  â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  - MessageAvatar            â”‚  â”‚  â”‚  â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  - Response (Streamdown)    â”‚  â”‚  â”‚  â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  ChatInput                               â”‚  â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”‚ AI-ELEMENT: PromptInput            â”‚  â”‚  â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  - PromptInputTextarea             â”‚  â”‚  â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  - PromptInputSubmit               â”‚  â”‚  â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  - æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«æ©Ÿèƒ½                  â”‚  â”‚  â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ HTTP POST
                            â”‚ /api/chat
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Backend (API)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  app/api/chat/route.ts                                 â”‚  â”‚
â”‚  â”‚  - ãƒªã‚¯ã‚¨ã‚¹ãƒˆå—ä¿¡                                          â”‚  â”‚
â”‚  â”‚  - Mastra ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå–å¾—                                â”‚  â”‚
â”‚  â”‚  - ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ¬ã‚¹ãƒãƒ³ã‚¹ç”Ÿæˆ                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Mastra.ai Layer                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Mastra Instance (src/mastra/index.ts)                 â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  Weather Agent                                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - instructions: ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ                â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - model: 'openai/gpt-4o-mini'                 â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - tools: { weatherTool }                      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - scorers: å“è³ªã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°                       â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - memory: ä¼šè©±å±¥æ­´ä¿å­˜                           â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  Weather Tool (src/mastra/tools/weather-tool.ts)â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - ã‚¸ã‚ªã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ï¼ˆåœ°åâ†’åº§æ¨™å¤‰æ›ï¼‰                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - Open-Meteo API å‘¼ã³å‡ºã—                       â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - å¤©æ°—æƒ…å ±å–å¾—ï¼†æ•´å½¢                               â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  Storage (LibSQLStore)                          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - ä¼šè©±å±¥æ­´                                        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°çµæœ                                 â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - è¦³æ¸¬ãƒ‡ãƒ¼ã‚¿                                      â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
                   External API (Open-Meteo)
```

---

## ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè©³ç´°

### 1. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å±¤

#### 1.1 app/page.tsx

**å½¹å‰²**: ãƒãƒ£ãƒƒãƒˆãƒšãƒ¼ã‚¸ã®ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

**ã‚³ãƒ¼ãƒ‰å ´æ‰€**: `app/page.tsx:13-42`

**ä¸»è¦ãªæ©Ÿèƒ½**:

```typescript
export default function ChatPage() {
  const { messages, sendMessage, status } = useChat();
  const [draft, setDraft] = useState('');

  const handleSubmit = (message: PromptInputMessage) => {
    const messageText = message.text?.trim();
    if (!messageText) return;
    void sendMessage({ text: messageText });
    setDraft('');
  };

  return (
    <ChatContainer>
      <ChatHeader />
      <ChatConversation messages={messages} status={status} />
      <ChatInput onSubmit={handleSubmit} />
    </ChatContainer>
  );
}
```

**çŠ¶æ…‹ç®¡ç†**:

- `messages`: ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é…åˆ—
- `draft`: å…¥åŠ›ä¸­ã®ãƒ†ã‚­ã‚¹ãƒˆ
- `status`: ãƒãƒ£ãƒƒãƒˆã®çŠ¶æ…‹ (`idle`, `submitted`, `streaming`, `error`)

#### 1.2 useChat ãƒ•ãƒƒã‚¯ (@ai-sdk/react)

**å½¹å‰²**: AI ãƒãƒ£ãƒƒãƒˆã®ãƒ­ã‚¸ãƒƒã‚¯ã¨ã‚¹ãƒ†ãƒ¼ãƒˆç®¡ç†ã‚’æä¾›

**ä¸»è¦ãªæ©Ÿèƒ½**:

- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é…åˆ—ã®ç®¡ç†
- API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ (`/api/chat`) ã¸ã®è‡ªå‹•æ¥ç¶š
- ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å‡¦ç†
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

**è¿”ã‚Šå€¤**:

```typescript
{
  messages: UIMessage[];      // ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é…åˆ—
  sendMessage: (msg) => void; // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡é–¢æ•°
  status: ChatStatus;         // 'idle' | 'submitted' | 'streaming' | 'error'
}
```

### 2. UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå±¤

#### 2.1 ChatContainer

**å½¹å‰²**: ãƒãƒ£ãƒƒãƒˆ UI ã®æœ€å¤–æ ã‚³ãƒ³ãƒ†ãƒŠ

**ã‚³ãƒ¼ãƒ‰å ´æ‰€**: `components/chat/chat-container.tsx:3-15`

**ç‰¹å¾´**:

- ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³é«˜ã•ã® flex ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
- æœ€å¤§å¹… `max-w-3xl` ã§ä¸­å¤®é…ç½®
- ã‚·ãƒ£ãƒ‰ã‚¦ã¨ãƒœãƒ¼ãƒ€ãƒ¼åŠå¾„ã«ã‚ˆã‚‹è¦–è¦šçš„åŒºåˆ‡ã‚Š

#### 2.2 ChatHeader

**å½¹å‰²**: ãƒãƒ£ãƒƒãƒˆã®ã‚¿ã‚¤ãƒˆãƒ«ã¨èª¬æ˜ã‚’è¡¨ç¤º

**ã‚³ãƒ¼ãƒ‰å ´æ‰€**: `components/chat/chat-header.tsx:6-13`

**ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£**:

```typescript
{
  title: string; // "Weather Chat Assistant"
  description: string; // "Ask me about the weather..."
}
```

#### 2.3 ChatConversation

**å½¹å‰²**: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒªã‚¹ãƒˆã®è¡¨ç¤ºã¨çŠ¶æ…‹ç®¡ç†

**ã‚³ãƒ¼ãƒ‰å ´æ‰€**: `components/chat/chat-conversation.tsx:20-72`

**ä¸»è¦ãªæ©Ÿèƒ½**:

- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒªã‚¹ãƒˆã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
- ç©ºçŠ¶æ…‹ã®è¡¨ç¤º
- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã®è¡¨ç¤º
- ã‚¨ãƒ©ãƒ¼çŠ¶æ…‹ã®è¡¨ç¤º

**å†…éƒ¨ã§ä½¿ç”¨ã™ã‚‹ AI-ELEMENT ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**:

- `Conversation`: ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ç®¡ç†ã‚³ãƒ³ãƒ†ãƒŠ
- `ConversationContent`: ã‚³ãƒ³ãƒ†ãƒ³ãƒ„é ˜åŸŸ
- `ConversationEmptyState`: ç©ºçŠ¶æ…‹è¡¨ç¤º
- `ConversationScrollButton`: ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒœã‚¿ãƒ³

#### 2.4 ChatInput

**å½¹å‰²**: ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã‚’å—ã‘ä»˜ã‘ã‚‹

**ã‚³ãƒ¼ãƒ‰å ´æ‰€**: `components/chat/chat-input.tsx:46-200`

**ä¸»è¦ãªæ©Ÿèƒ½**:

- ãƒ˜ãƒƒãƒ€ãƒ¼: ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆæƒ…å ±ã€Tips ãƒ›ãƒãƒ¼ã‚«ãƒ¼ãƒ‰ã€ãƒ¢ãƒ‡ãƒ«é¸æŠ (`gpt-4o-mini / gpt-4o / gpt-3.5-turbo`)ã€è¨­å®šãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼ˆä¼šè©±ã‚¯ãƒªã‚¢ï¼‰
- æœ¬æ–‡: ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã€æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆç”»åƒã‚µãƒ ãƒã‚¤ãƒ«ã¨å‰Šé™¤ãƒœã‚¿ãƒ³ï¼‰
- ãƒ•ãƒƒã‚¿ãƒ¼: æ·»ä»˜ãƒœã‚¿ãƒ³ï¼ˆã‚¯ãƒªãƒƒã‚¯ã§ãƒ•ã‚¡ã‚¤ãƒ«ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’ç›´æ¥èµ·å‹•ï¼‰ã€éŸ³å£°å…¥åŠ›ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã€é€ä¿¡ãƒœã‚¿ãƒ³ï¼ˆ`submitted`/`streaming`/`error` çŠ¶æ…‹ã«å¿œã˜ã¦ã‚¢ã‚¤ã‚³ãƒ³åˆ‡ã‚Šæ›¿ãˆï¼‰
- Enter ã‚­ãƒ¼ã§é€ä¿¡ï¼ˆShift+Enter ã§æ”¹è¡Œï¼‰ã€é€ä¿¡ä¸­ã®å…¥åŠ›ç„¡åŠ¹åŒ–

**å†…éƒ¨ã§ä½¿ç”¨ã™ã‚‹ AI-ELEMENT ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**:

- `PromptInput`: å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ æœ¬ä½“
- `PromptInputTextarea`: ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢
- `PromptInputSubmit`: é€ä¿¡ãƒœã‚¿ãƒ³
- `PromptInputAttachments`: æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ãƒªã‚¹ãƒˆæç”»
- `PromptInputModelSelect*`: ãƒ¢ãƒ‡ãƒ«é¸æŠ UI
- `PromptInputActionMenu*`: è¨­å®šãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³
- `PromptInputButton`: æ±ç”¨ãƒˆãƒªã‚¬ãƒ¼ãƒœã‚¿ãƒ³ï¼ˆæ·»ä»˜ãƒœã‚¿ãƒ³ã§ä½¿ç”¨ï¼‰

#### 2.5 ChatMessageItem

**å½¹å‰²**: å€‹åˆ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è¡¨ç¤º

**ã‚³ãƒ¼ãƒ‰å ´æ‰€**: `components/chat/chat-message-item.tsx:52-64`

**ä¸»è¦ãªæ©Ÿèƒ½**:

- ãƒ¦ãƒ¼ã‚¶ãƒ¼/ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã®åˆ¤å®š
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ‘ãƒ¼ãƒ„ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
  - ãƒ†ã‚­ã‚¹ãƒˆãƒ‘ãƒ¼ãƒˆ
  - ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—ãƒ‘ãƒ¼ãƒˆï¼ˆä¾‹: "ğŸ”§ Using tool: get-weather..."ï¼‰
  - æ¨è«–ãƒ‘ãƒ¼ãƒˆ

**å†…éƒ¨ã§ä½¿ç”¨ã™ã‚‹ AI-ELEMENT ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**:

- `Message`: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚³ãƒ³ãƒ†ãƒŠ
- `MessageAvatar`: ã‚¢ãƒã‚¿ãƒ¼è¡¨ç¤ºï¼ˆã‚¢ã‚¤ã‚³ãƒ³ãƒ™ãƒ¼ã‚¹ï¼‰
- `MessageContent`: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹
- `Response`: ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ï¼ˆStreamdown ä½¿ç”¨ï¼‰

### 3. AI-ELEMENT ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

#### 3.1 PromptInput

**å½¹å‰²**: é«˜æ©Ÿèƒ½ãªå…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ 

**ã‚³ãƒ¼ãƒ‰å ´æ‰€**: `components/ai-elements/prompt-input.tsx`

**ä¸»è¦ãªæ©Ÿèƒ½**:

- ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›
- ãƒ•ã‚¡ã‚¤ãƒ«æ·»ä»˜ï¼ˆãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—å¯¾å¿œï¼‰
- ãƒšãƒ¼ã‚¹ãƒˆæ™‚ã®ç”»åƒè‡ªå‹•æ·»ä»˜
- ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ‰ãƒ­ãƒƒãƒ—ã‚¾ãƒ¼ãƒ³ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
- æœ€å¤§ãƒ•ã‚¡ã‚¤ãƒ«æ•°ãƒ»ã‚µã‚¤ã‚ºåˆ¶é™
- Enter ã‚­ãƒ¼ã§ã®é€ä¿¡ï¼ˆIME å¯¾å¿œï¼‰
- Backspace ã§ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤

**ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ãƒ¢ãƒ¼ãƒ‰**:
`PromptInputProvider` ã§ãƒ©ãƒƒãƒ—ã™ã‚‹ã“ã¨ã§ã€çŠ¶æ…‹ã‚’è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ç®¡ç†å¯èƒ½ã€‚

#### 3.2 Conversation

**å½¹å‰²**: ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ç®¡ç†ä»˜ããƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒªã‚¹ãƒˆã‚³ãƒ³ãƒ†ãƒŠ

**ã‚³ãƒ¼ãƒ‰å ´æ‰€**: `components/ai-elements/conversation.tsx:12-97`

**ä¸»è¦ãªæ©Ÿèƒ½**:

- è‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼ˆ`use-stick-to-bottom` ä½¿ç”¨ï¼‰
- ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒœã‚¿ãƒ³è¡¨ç¤º
- ç©ºçŠ¶æ…‹è¡¨ç¤º

#### 3.3 Message / MessageAvatar

**å½¹å‰²**: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨é€ä¿¡è€…ã‚¢ãƒã‚¿ãƒ¼ã®è¡¨ç¤º

**ã‚³ãƒ¼ãƒ‰å ´æ‰€**: `components/ai-elements/message.tsx`

**ç‰¹å¾´**:

- ãƒ¦ãƒ¼ã‚¶ãƒ¼/ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ç•°ãªã‚‹ã‚¹ã‚¿ã‚¤ãƒ«
- ã‚¢ã‚¤ã‚³ãƒ³ãƒ™ãƒ¼ã‚¹ã®ã‚¢ãƒã‚¿ãƒ¼ï¼ˆBot/User ã‚¢ã‚¤ã‚³ãƒ³ï¼‰
- `contained` / `flat` ã®ãƒãƒªã‚¢ãƒ³ãƒˆ

#### 3.4 Response

**å½¹å‰²**: ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°

**ã‚³ãƒ¼ãƒ‰å ´æ‰€**: `components/ai-elements/response.tsx:9-22`

**ç‰¹å¾´**:

- `Streamdown` ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
- ãƒ¡ãƒ¢åŒ–ã«ã‚ˆã‚‹æœ€é©åŒ–

---

## ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

### 1. ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã‹ã‚‰ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¾ã§ã®æµã‚Œ

```
[1] ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›
     â†“
[2] ChatInput (PromptInput) ãŒãƒ•ã‚©ãƒ¼ãƒ ã‚’å—ã‘å–ã‚‹
     â†“
[3] handleSubmit ãŒå‘¼ã°ã‚Œã‚‹ (app/page.tsx:17-25)
     â†“
[4] useChat ã® sendMessage({ text: messageText }) ãŒå®Ÿè¡Œã•ã‚Œã‚‹
     â†“
[5] useChat ãŒ POST /api/chat ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡
     â”œâ”€ headers: { 'Content-Type': 'application/json' }
     â””â”€ body: { messages: [...previousMessages, newMessage] }
     â†“
[6] API Route ãŒãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ä¿¡ (app/api/chat/route.ts:7-23)
     â†“
[7] Mastra ã‹ã‚‰ weatherAgent ã‚’å–å¾—
     â”œâ”€ mastra.getAgent('weatherAgent')
     â””â”€ src/mastra/index.ts:14 ã§å®šç¾©
     â†“
[8] weatherAgent.stream(messages, { format: 'aisdk' }) ã‚’å‘¼ã³å‡ºã—
     â†“
[9] Agent ãŒ LLM (openai/gpt-4o-mini) ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
     â”œâ”€ ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆinstructionsï¼‰ã‚’å«ã‚€
     â””â”€ åˆ©ç”¨å¯èƒ½ãªãƒ„ãƒ¼ãƒ«æƒ…å ±ã‚’å«ã‚€
     â†“
[10] LLM ãŒãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—ã‚’åˆ¤æ–­
     â”œâ”€ å¤©æ°—æƒ…å ±ãŒå¿…è¦ â†’ weatherTool ã‚’å‘¼ã³å‡ºã—
     â””â”€ ä¸è¦ â†’ ç›´æ¥å›ç­”
     â†“
[11] weatherTool ãŒå®Ÿè¡Œã•ã‚Œã‚‹ (src/mastra/tools/weather-tool.ts:38-40)
     â”œâ”€ Open-Meteo Geocoding API ã§åœ°åâ†’åº§æ¨™å¤‰æ›
     â””â”€ Open-Meteo Weather API ã§å¤©æ°—æƒ…å ±å–å¾—
     â†“
[12] ãƒ„ãƒ¼ãƒ«çµæœãŒ LLM ã«è¿”ã•ã‚Œã‚‹
     â†“
[13] LLM ãŒæœ€çµ‚å›ç­”ã‚’ç”Ÿæˆï¼ˆã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ï¼‰
     â†“
[14] Agent ãŒã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ç”Ÿæˆ
     â”œâ”€ stream.toUIMessageStreamResponse()
     â””â”€ AI SDK å½¢å¼ã®ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°
     â†“
[15] useChat ãŒã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã‚’å—ä¿¡
     â”œâ”€ messages é…åˆ—ã«é †æ¬¡è¿½åŠ 
     â””â”€ status ã‚’ 'streaming' â†’ 'idle' ã«æ›´æ–°
     â†“
[16] ChatConversation ãŒå†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
     â†“
[17] ChatMessageItem â†’ Response (Streamdown) ãŒãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³è¡¨ç¤º
```

### 2. ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®çŠ¶æ…‹é·ç§»

```
[åˆæœŸçŠ¶æ…‹]
status: 'idle'
messages: []

â†“ [ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé€ä¿¡]

status: 'submitted'
messages: [{ role: 'user', content: 'Tokyo ã®å¤©æ°—ã¯?' }]

â†“ [API ãƒ¬ã‚¹ãƒãƒ³ã‚¹é–‹å§‹]

status: 'streaming'
messages: [
  { role: 'user', content: 'Tokyo ã®å¤©æ°—ã¯?' },
  { role: 'assistant', parts: [
    { type: 'tool-call', toolName: 'get-weather', args: {...} }
  ]}
]

â†“ [ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ä¸­]

messages: [
  { role: 'user', content: 'Tokyo ã®å¤©æ°—ã¯?' },
  { role: 'assistant', parts: [
    { type: 'tool-call', ... },
    { type: 'tool-result', result: {...} },
    { type: 'text', text: 'Tokyo ã®ç¾åœ¨ã®æ°—æ¸©ã¯...' } // é †æ¬¡è¿½åŠ 
  ]}
]

â†“ [å®Œäº†]

status: 'idle'
messages: [å®Œå…¨ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸]
```

---

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰

| æŠ€è¡“                         | ç”¨é€”                   | å‚™è€ƒ                     |
| ---------------------------- | ---------------------- | ------------------------ |
| **Next.js 15**               | ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯         | App Router ä½¿ç”¨          |
| **React 19**                 | UI ãƒ©ã‚¤ãƒ–ãƒ©ãƒª          | Server Components å¯¾å¿œ   |
| **TypeScript**               | å‹å®‰å…¨æ€§               | å³æ ¼ãªå‹ãƒã‚§ãƒƒã‚¯         |
| **@ai-sdk/react**            | AI ãƒãƒ£ãƒƒãƒˆãƒ­ã‚¸ãƒƒã‚¯    | useChat ãƒ•ãƒƒã‚¯æä¾›       |
| **AI-ELEMENT**               | UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ      | é«˜æ©Ÿèƒ½ãƒãƒ£ãƒƒãƒˆ UI        |
| **Streamdown**               | ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³           | ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å¯¾å¿œ       |
| **Tailwind CSS**             | ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°           | ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ |
| **class-variance-authority** | ã‚¹ã‚¿ã‚¤ãƒ«ãƒãƒªã‚¢ãƒ³ãƒˆç®¡ç† | cva é–¢æ•°                 |
| **Lucide React**             | ã‚¢ã‚¤ã‚³ãƒ³               | Bot, User ã‚¢ã‚¤ã‚³ãƒ³       |

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰

| æŠ€è¡“                   | ç”¨é€”              | å‚™è€ƒ                     |
| ---------------------- | ----------------- | ------------------------ |
| **Mastra.ai**          | AI ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ | ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ»ãƒ„ãƒ¼ãƒ«ç®¡ç† |
| **OpenAI GPT-4o-mini** | LLM               | ãƒ†ã‚­ã‚¹ãƒˆç”Ÿæˆ             |
| **LibSQL**             | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹      | SQLite äº’æ›              |
| **Pino**               | ãƒ­ã‚®ãƒ³ã‚°          | é«˜é€Ÿãªæ§‹é€ åŒ–ãƒ­ã‚°         |

### å¤–éƒ¨ API

| API                      | ç”¨é€”          | ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ                                   |
| ------------------------ | ------------- | ------------------------------------------------ |
| **Open-Meteo Geocoding** | åœ°åâ†’åº§æ¨™å¤‰æ› | `https://geocoding-api.open-meteo.com/v1/search` |
| **Open-Meteo Weather**   | å¤©æ°—æƒ…å ±å–å¾—  | `https://api.open-meteo.com/v1/forecast`         |

---

## Mastra.ai ã®è¨­å®šè©³ç´°

### Agent è¨­å®š

**ã‚³ãƒ¼ãƒ‰å ´æ‰€**: `src/mastra/agents/weather-agent.ts:7-53`

```typescript
export const weatherAgent = new Agent({
  name: 'Weather Agent',
  instructions: `...`, // ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
  model: 'openai/gpt-4o-mini',
  tools: { weatherTool },
  scorers: {
    toolCallAppropriateness: { ... },
    completeness: { ... },
    translation: { ... }
  },
  memory: new Memory({
    storage: new LibSQLStore({
      url: 'file:../mastra.db'
    })
  })
});
```

### Tool è¨­å®š

**ã‚³ãƒ¼ãƒ‰å ´æ‰€**: `src/mastra/tools/weather-tool.ts:23-41`

```typescript
export const weatherTool = createTool({
  id: 'get-weather',
  description: 'Get current weather for a location',
  inputSchema: z.object({
    location: z.string().describe('City name'),
  }),
  outputSchema: z.object({
    temperature: z.number(),
    feelsLike: z.number(),
    humidity: z.number(),
    windSpeed: z.number(),
    windGust: z.number(),
    conditions: z.string(),
    location: z.string(),
  }),
  execute: async ({ context }) => {
    return await getWeather(context.location);
  },
});
```

### Mastra ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹

**ã‚³ãƒ¼ãƒ‰å ´æ‰€**: `src/mastra/index.ts:12-36`

```typescript
export const mastra = new Mastra({
  workflows: { weatherWorkflow },
  agents: { weatherAgent },
  scorers: { ... },
  storage: new LibSQLStore({
    url: ':memory:'  // ã¾ãŸã¯ 'file:../mastra.db'
  }),
  logger: new PinoLogger({
    name: 'Mastra',
    level: 'info'
  }),
  observability: {
    default: { enabled: true }
  }
});
```

---

## é‡è¦ãªãƒã‚¤ãƒ³ãƒˆ

### 1. ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å‡¦ç†

- **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**: useChat ãŒã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã‚’è‡ªå‹•å‡¦ç†
- **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰**: `weatherAgent.stream()` â†’ `toUIMessageStreamResponse()` ã§ AI SDK å½¢å¼ã«å¤‰æ›
- **UI**: Response ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ (Streamdown) ãŒãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°

### 2. ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—ãƒ•ãƒ­ãƒ¼

```
ãƒ¦ãƒ¼ã‚¶ãƒ¼: "Tokyo ã®å¤©æ°—ã¯?"
  â†“
LLM: ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—ãŒå¿…è¦ã¨åˆ¤æ–­
  â†“
weatherTool.execute({ location: "Tokyo" })
  â†“
Open-Meteo API å‘¼ã³å‡ºã—
  â†“
ãƒ„ãƒ¼ãƒ«çµæœã‚’ LLM ã«è¿”ã™
  â†“
LLM: çµæœã‚’æ•´å½¢ã—ã¦å›ç­”ç”Ÿæˆ
```

### 3. ãƒ¡ãƒ¢ãƒªæ©Ÿèƒ½

- `Memory` + `LibSQLStore` ã§ä¼šè©±å±¥æ­´ã‚’æ°¸ç¶šåŒ–
- ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒéå»ã®ä¼šè©±ã‚’å‚ç…§å¯èƒ½
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã® context ç®¡ç†

### 4. ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°æ©Ÿèƒ½

Mastra ã¯ä»¥ä¸‹ã®ã‚¹ã‚³ã‚¢ãƒ©ãƒ¼ã§å“è³ªã‚’è©•ä¾¡:

- **toolCallAppropriateness**: ãƒ„ãƒ¼ãƒ«ä½¿ç”¨ã®é©åˆ‡æ€§
- **completeness**: å›ç­”ã®å®Œå…¨æ€§
- **translation**: ç¿»è¨³å“è³ªï¼ˆå¤šè¨€èªå¯¾å¿œï¼‰

### 5. è¦³æ¸¬å¯èƒ½æ€§

- OpenTelemetry ãƒ™ãƒ¼ã‚¹ã®ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°
- ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ»ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ãƒ­ã‚°è¨˜éŒ²
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–

---

## ã¾ã¨ã‚

ã“ã®ã‚·ã‚¹ãƒ†ãƒ ã¯ã€ä»¥ä¸‹ã® 3 å±¤ã§æ§‹æˆã•ã‚Œã¦ã„ã¾ã™:

1. **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å±¤**: Next.js + AI SDK + AI-ELEMENT ã«ã‚ˆã‚‹ UI
2. **API å±¤**: Next.js API Routes ã«ã‚ˆã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
3. **AI å±¤**: Mastra.ai ã«ã‚ˆã‚‹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ»ãƒ„ãƒ¼ãƒ«ãƒ»ãƒ¡ãƒ¢ãƒªç®¡ç†

å„å±¤ã¯æ˜ç¢ºã«åˆ†é›¢ã•ã‚Œã¦ãŠã‚Šã€ç–çµåˆãªè¨­è¨ˆã¨ãªã£ã¦ã„ã¾ã™ã€‚useChat ãƒ•ãƒƒã‚¯ãŒ API ã¨ã®ã‚„ã‚Šå–ã‚Šã‚’æŠ½è±¡åŒ–ã—ã€Mastra.ai ãŒãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’æŠ½è±¡åŒ–ã™ã‚‹ã“ã¨ã§ã€ä¿å®ˆæ€§ã®é«˜ã„ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’å®Ÿç¾ã—ã¦ã„ã¾ã™ã€‚
