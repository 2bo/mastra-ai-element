# Langfuse Local Setup

This directory contains the Docker Compose configuration for running Langfuse locally with Garage S3-compatible storage.

## Getting Started

1. **Start Langfuse:**

   ```bash
   cd langfuse
   docker compose up -d
   ```

2. **Initialize Garage S3 Storage** (first time only or after `docker compose down -v`):

   ```bash
   ./init-garage.sh
   ```

   This script will:
   - Configure Garage layout and storage
   - Create S3 access keys
   - Create the `langfuse` bucket
   - Automatically update `.env` with new credentials
   - Restart Langfuse services

3. **Wait for services to be ready** (about 20-30 seconds):

   ```bash
   docker compose logs -f langfuse-web
   ```

   Wait for the "Ready" message.

4. **Access Langfuse UI:**
   Open http://localhost:3001 in your browser.

5. **Stop Langfuse:**

   ```bash
   docker compose down
   ```

6. **Stop and remove all data:**

   ```bash
   docker compose down -v
   ```

   ⚠️ **Note:** If you remove volumes with `-v`, you need to run `./init-garage.sh` again to reinitialize Garage storage.

## Services

- **langfuse-web**: Main web application (port 3001)
- **langfuse-worker**: Background worker for async processing (port 3030)
- **postgres**: PostgreSQL database (port 5432)
- **clickhouse**: ClickHouse OLAP database (ports 8123, 9000)
- **redis**: Redis cache (port 6379)
- **garage**: Garage S3-compatible object storage (ports 3900, 3902)

## Architecture

This setup is based on the official Langfuse v3 Docker Compose configuration with Garage replacing MinIO as the S3-compatible storage backend. Garage is a lightweight, Rust-based S3-compatible storage system.

### Garage Storage

Garage has been initialized with:

- Bucket name: `langfuse`
- Access Key ID: (see `.env` file, generated by `init-garage.sh`)
- Secret Access Key: (see `.env` file)
- Region: `garage`
- Endpoints:
  - Internal (for Langfuse worker): http://garage:3900
  - External (for browser uploads): http://localhost:3900

## API Keys and Login

### Automatic Setup (Recommended)

The `.env` file includes pre-configured values that automatically create:

- **Organization**: Development Organization
- **Project**: Development Project
- **User**: admin@example.com
- **API Keys**: Already generated and ready to use

**Login Credentials:**

- URL: http://localhost:3001
- Email: `admin@example.com`
- Password: (see `LANGFUSE_INIT_USER_PASSWORD` in `.env`)

**API Keys for Mastra Integration:**

Add these to your project root `.env` file:

```bash
LANGFUSE_PUBLIC_KEY=pk-lf-226360a48fe60f30687aff6f2fdb2b2b
LANGFUSE_SECRET_KEY=sk-lf-6bb7379453c8879eb6d863c4d6e05f6f
LANGFUSE_BASE_URL=http://localhost:3001
```

### Manual Setup (Optional)

If you prefer to create your own organization/project:

1. Clear the `LANGFUSE_INIT_*` variables in `.env`
2. Restart services: `docker compose restart langfuse-web langfuse-worker`
3. Open http://localhost:3001 and create an account
4. Create a project and get API keys from Settings → API Keys

## Configuration

All sensitive configuration is stored in the `.env` file in this directory. The configuration includes:

- Database credentials (PostgreSQL, ClickHouse, Redis)
- Garage S3 access keys
- Langfuse secrets (SALT, ENCRYPTION_KEY, NEXTAUTH_SECRET)

⚠️ **Security Note**: The `.env` file contains generated secure credentials. Do not commit this file to version control.

## Notes

- This setup is for local development and testing only
- For production, review and update all passwords and secrets in `.env`
- Data persists in Docker volumes unless you run `docker compose down -v`
- Port 3001 is used instead of 3000 to avoid conflicts with other development servers
